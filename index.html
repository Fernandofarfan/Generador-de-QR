<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Suite Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css?v=9">
    <!-- Libraries -->
    <script src="lib/qr-code-styling.js"></script>
    <script src="lib/html5-qrcode.min.js"></script>
    <script src="lib/jszip.min.js"></script>
    <script src="lib/jspdf.umd.min.js"></script>
</head>
<body>

    <header class="top-bar">
        <div class="logo">
            <span>üî≤</span> QR Suite
        </div>
        <div class="top-actions">
            <button id="installApp" class="action-btn" style="display:none;">‚¨á App</button>
            <button id="langToggle" class="icon-btn">üá™üá∏</button>
            <button id="darkModeToggle" class="icon-btn">üåô</button>
        </div>
    </header>

    <div class="app-container">
        
        <!-- SIDEBAR MENU -->
        <nav class="sidebar">
            <div class="nav-group">
                <h3>B√°sicos</h3>
                <button class="nav-btn active" data-target="url">üîó URL / Web</button>
                <button class="nav-btn" data-target="text">üìÑ Texto</button>
            </div>
            
            <div class="nav-group">
                <h3>Contacto</h3>
                <button class="nav-btn" data-target="vcard">üë§ VCard</button>
                <button class="nav-btn" data-target="location">üìç Mapa</button>
                <button class="nav-btn" data-target="whatsapp">üí¨ WhatsApp</button>
                <button class="nav-btn" data-target="email">üìß Email</button>
                <button class="nav-btn" data-target="event">üìÖ Evento</button>
            </div>
            
            <div class="nav-group">
                <h3>Redes & Wifi</h3>
                <button class="nav-btn" data-target="wifi">üì∂ WiFi</button>
                <button class="nav-btn" data-target="social">üì∑ RRSS</button>
            </div>

            <div class="nav-group">
                <h3>Finanzas</h3>
                <button class="nav-btn" data-target="crypto">‚Çø Cripto</button>
                <button class="nav-btn" data-target="paypal">üí≥ PayPal</button>
            </div>

            <div class="nav-group">
                <h3>Herramientas</h3>
                <button class="nav-btn" data-target="bulk">üì¶ Masivo (ZIP/PDF)</button>
                <button class="nav-btn" data-target="scan">üì∑ Esc√°ner</button>
            </div>
        </nav>

        <!-- MAIN FORM AREA -->
        <main class="main-content">
            
            <!-- URL Form -->
            <div id="form-url" class="form-section active">
                <h2>URL / Sitio Web</h2>
                <div class="input-group">
                    <input type="url" id="urlInput" placeholder="https://ejemplo.com">
                    <button id="shortenBtn" class="secondary-btn">‚úÇ Acortar</button>
                </div>
                
                <details class="utm-accordion">
                    <summary>üìà Opciones de Rastreo (UTM)</summary>
                    <div class="utm-grid">
                        <input type="text" id="utmSource" placeholder="Fuente (ej. instagram)">
                        <input type="text" id="utmMedium" placeholder="Medio (ej. story)">
                        <input type="text" id="utmCampaign" placeholder="Campa√±a (ej. verano2026)">
                    </div>
                </details>
            </div>

            <!-- Text Form -->
            <div id="form-text" class="form-section">
                <h2>Texto Libre</h2>
                <textarea id="textInput" placeholder="Escribe tu mensaje..."></textarea>
            </div>

            <!-- WIFI Form -->
            <div id="form-wifi" class="form-section">
                <h2>WiFi Acceso</h2>
                <input type="text" id="wifiSSID" placeholder="SSID (Nombre de Red)">
                <input type="password" id="wifiPass" placeholder="Contrase√±a">
                <select id="wifiType">
                    <option value="WPA">WPA/WPA2</option>
                    <option value="WEP">WEP</option>
                    <option value="nopass">Sin clave</option>
                </select>
            </div>

            <!-- VCARD Form -->
            <div id="form-vcard" class="form-section">
                <h2>Tarjeta de Contacto</h2>
                <input type="text" id="vcardName" placeholder="Nombre">
                <input type="text" id="vcardLastname" placeholder="Apellido">
                <input type="tel" id="vcardPhone" placeholder="Tel√©fono">
                <input type="email" id="vcardEmail" placeholder="Email">
            </div>

            <!-- Geo Form (Replaces old logic if any, or simpler text) -->
            <div id="form-location" class="form-section">
                <h2>Ubicaci√≥n (Google Maps)</h2>
                <input type="text" id="locLat" placeholder="Latitud">
                <input type="text" id="locLon" placeholder="Longitud">
                <button id="locateMeBtn" class="secondary-btn">üìç Mi Ubicaci√≥n</button>
            </div>

            <!-- WhatsApp Form -->
            <div id="form-whatsapp" class="form-section">
                <h2>WhatsApp Directo</h2>
                <input type="tel" id="waPhone" placeholder="N√∫mero (+52...)">
                <textarea id="waMessage" placeholder="Mensaje predefinido..."></textarea>
            </div>

            <!-- Email Form -->
            <div id="form-email" class="form-section">
                <h2>Enviar Correo</h2>
                <input type="email" id="emailTo" placeholder="Para:">
                <input type="text" id="emailSub" placeholder="Asunto:">
                <textarea id="emailBody" placeholder="Mensaje..."></textarea>
            </div>

            <!-- Event Form -->
            <div id="form-event" class="form-section">
                <h2>Evento Calendario</h2>
                <input type="text" id="eventTitle" placeholder="T√≠tulo del Evento">
                <input type="text" id="eventLoc" placeholder="Lugar">
                <label>Inicio:</label>
                <input type="datetime-local" id="eventStart">
                <label>Fin:</label>
                <input type="datetime-local" id="eventEnd">
            </div>

            <!-- Social Form -->
            <div id="form-social" class="form-section">
                <h2>Redes Sociales</h2>
                <input type="text" id="socialUser" placeholder="Usuario">
                <select id="socialPlat">
                    <option value="instagram">Instagram</option>
                    <option value="facebook">Facebook</option>
                    <option value="twitter">X (Twitter)</option>
                    <option value="tiktok">TikTok</option>
                    <option value="linkedin">LinkedIn</option>
                </select>
            </div>

            <!-- Crypto Form (NEW) -->
            <div id="form-crypto" class="form-section">
                <h2>Criptomonedas</h2>
                <select id="cryptoType">
                    <option value="bitcoin">Bitcoin (BTC)</option>
                    <option value="ethereum">Ethereum (ETH)</option>
                </select>
                <input type="text" id="cryptoAddr" placeholder="Direcci√≥n de la Billetera">
                <input type="number" id="cryptoAmount" placeholder="Monto (Opcional)">
            </div>

            <!-- PayPal Form (NEW) -->
            <div id="form-paypal" class="form-section">
                <h2>PayPal.Me</h2>
                <input type="text" id="paypalUser" placeholder="Usuario (sin @)">
                <div class="row">
                    <select id="paypalCurrency">
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="MXN">MXN</option>
                    </select>
                    <input type="number" id="paypalAmount" placeholder="Monto (Opcional)">
                </div>
            </div>

            <!-- Bulk Form -->
            <div id="form-bulk" class="form-section">
                <h2>Generaci√≥n Masiva</h2>
                <p class="hint">Pega un enlace o texto por l√≠nea.</p>
                <textarea id="bulkInput" rows="6" placeholder="https://site1.com&#10;https://site2.com&#10;Pedro..."></textarea>
                <p>Formatos de salida:</p>
                <div class="row">
                    <button id="bulkZipBtn" class="secondary-btn">üì¶ Descargar ZIP</button>
                    <button id="bulkPdfBtn" class="secondary-btn">üìÑ Descargar PDF A4</button>
                </div>
            </div>

            <!-- Scanner Section -->
            <div id="scanner-section" class="form-section hidden-scan">
                <h2>Esc√°ner QR</h2>
                <div id="reader"></div>
                <div class="scan-controls">
                    <button id="flashBtn" class="hidden">üî¶ Linterna</button>
                    <input type="file" id="fileScanInput" accept="image/*">
                </div>
                <p id="scanResult">Esperando c√°mara...</p>
                <button id="copyScanBtn" class="secondary-btn" style="display:none;">Copiar Texto</button>
            </div>

            <!-- DESIGN ACCORDION -->
            <details id="designSection" class="design-panel" open>
                <summary>üé® Personalizar Dise√±o</summary>
                <div class="design-content">
                    <div class="row">
                        <div>
                            <label>Puntos</label>
                            <select id="dotsType">
                                <option value="square">Cuadrado</option>
                                <option value="dots">Puntos</option>
                                <option value="rounded">Redondeado</option>
                                <option value="classy">Elegante</option>
                                <option value="classy-rounded">Elegante II</option>
                            </select>
                        </div>
                        <div>
                            <label>Esquinas</label>
                            <select id="cornersType">
                                <option value="square">Cuadrada</option>
                                <option value="dot">Punto</option>
                                <option value="extra-rounded">Extra Redonda</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div>
                            <label>Color</label>
                            <input type="color" id="dotsColor" value="#000000">
                        </div>
                        <div>
                            <label>Fondo</label>
                            <input type="color" id="bgColor" value="#ffffff">
                        </div>
                    </div>

                    <div class="logo-upload">
                        <label>Logo Central</label>
                        <input type="file" id="logoInput" accept="image/*">
                        <label class="toggle-sm">
                            <input type="checkbox" id="removeBgToggle">
                            <span>Quitar fondo blanco del logo</span>
                        </label>
                        <div class="slider-group">
                            <label>Tama√±o</label>
                            <input type="range" id="logoSize" min="0.1" max="0.5" step="0.05" value="0.4">
                            <label>Margen</label>
                            <input type="range" id="logoMargin" min="0" max="20" step="1" value="5">
                        </div>
                    </div>

                    <label class="toggle">
                        <input type="checkbox" id="useGradient">
                        <span>Usar Gradiente</span>
                    </label>
                    
                    <div id="gradientSection" class="hidden">
                        <div class="row">
                            <select id="gradientType">
                                <option value="linear">Lineal</option>
                                <option value="radial">Radial</option>
                            </select>
                            <input type="number" id="gradientRotation" value="45" placeholder="√Ångulo (0-360)">
                        </div>
                        <label>Color Final</label>
                        <input type="color" id="gradientColor2" value="#0000ff">
                    </div>

                    <label class="toggle">
                        <input type="checkbox" id="autoGenToggle" checked>
                        <span>Vista Previa Autom√°tica</span>
                    </label>
                    <label>Correcci√≥n: <select id="errorLevel"><option value="L">Baja</option><option value="M" selected>Media</option><option value="Q">Alta</option><option value="H">Max</option></select></label>
                </div>
            </details>

        </main>

        <!-- PREVIEW SIDEBAR -->
        <aside class="preview-area">
            <div class="qr-preview-container">
                <div id="qrcode"></div>
                <div id="densityWrapper" class="density-wrapper hidden">
                    <span id="densityLabel">Densidad: Baja</span>
                    <div class="density-bar"><div id="densityFill"></div></div>
                </div>
            </div>
            
            <div class="actions">
                <button id="generateBtn" class="primary-btn">üîÑ Generar</button>
                <div class="download-group">
                    <select id="downloadFormat">
                        <option value="png">PNG</option>
                        <option value="jpeg">JPG</option>
                        <option value="svg">SVG</option>
                    </select>
                    <button id="downloadBtn" class="action-btn">‚¨á Descargar</button>
                </div>
                <button id="shareBtn" class="action-btn outline">üîó Compartir</button>
            </div>

            <!-- SAVED ITEMS & HISTORY -->
            <div class="saved-section">
                <div class="tabs-mini">
                    <button class="mini-tab active" data-view="history">Historial</button>
                    <button class="mini-tab" data-view="presets">Estilos</button>
                </div>
                
                <div id="view-history" class="list-view">
                    <button id="clearHistory" class="text-btn">Borrar todo</button>
                    <ul id="historyList"></ul>
                </div>

                <div id="view-presets" class="list-view hidden">
                    <button id="savePresetBtn" class="secondary-btn small">+ Nuevo Estilo</button>
                    <div id="presetsList" class="presets-grid"></div>
                </div>
            </div>
        </aside>

    </div>

    <!-- TOAST -->
    <div id="toast"></div>

    <script src="script.js?v=9"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').then(reg => {
                console.log('SW registrado:', reg.scope);
                reg.onupdatefound = () => {
                    const installingWorker = reg.installing;
                    installingWorker.onstatechange = () => {
                        if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            // New content available
                            if(confirm("Nueva actualizaci√≥n disponible. ¬øRecargar?")) {
                                window.location.reload();
                            }
                        }
                    };
                };
            }).catch(console.error);
        }
    </script>
</body>
</html>